<div class="row" bis_skin_checked="1">
  <div class="col-12" bis_skin_checked="1">
    <div class="card" bis_skin_checked="1">
      <div class="card-body" bis_skin_checked="1">
        
        <div class="messages">
          {{#if error}}
          <div id="error" class="alert alert-danger" role="alert" bis_skin_checked="1">
            Ошибка категория! <a class="alert-link">{{error}}</a> Есть совпадения при добавлении данных. Избегайте добавления одинаковых значений.
          </div>
          {{/if}}
  
          {{#if success}}
          <div id="success" class="alert alert-success" role="alert" bis_skin_checked="1">
            Успешно! <a class="alert-link">{{success}}</a>
          </div>
          {{/if}}
        </div>

        <div class="d-flex align-items-center justify-content-between">
          <h4 class="card-title">Категории</h4>
          <button type="button" class="btn btn-light btn-rounded waves-effect" data-bs-toggle="modal"
            data-bs-target="#addModal">
            Добавить</button>
        </div>
        <p class="card-title-desc">Таблица Категориев</p>

        <div class="table-responsive" bis_skin_checked="1">
          <table class="table table-editable table-nowrap align-middle table-edits">
            <thead>
              <tr style="cursor: pointer;">
                <th>№</th>
                <th>Название</th>
                <th>Ссылка</th>
                <th>Фотография</th>
                <th>Статус</th>
                <th>Изменить</th>
                <th>Удалить</th>
              </tr>
            </thead>
            <tbody>
            {{#each category}}
              <tr data-id="1" style="cursor: pointer;">
                <td data-field="id" style="width: 80px">{{index}}</td>
                <td>{{title}}</td>
                <td>{{slug}}</td>
                <td><img src="{{img}}" style="height: 40px;"></td>
                <td><span class="{{class}}">{{status}}</span></td>
                <td style="width: 100px;">
                  <button class="btn btn-outline-secondary" title="Изменить" type="button" data-bs-toggle="modal"
                  data-bs-target="#editModal"
                  onclick="change('{{_id}}')">
                  <i class="fas fa-pencil-alt"></i>
                </button>
              </td>
              <td style="width: 100px">
                <a href="/category/delete/{{_id}}" class="btn btn-outline-secondary" title="Удалить">
                  <i class="uil-trash-alt"></i>
                </a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        </div>
        
        <div>
          <!-- add Category -->
          <div id="addModal" class="modal fade" tabindex="-1" aria-labelledby="myModalLabel" bis_skin_checked="1"
            style="display: none;" aria-hidden="true">
            <div class="modal-dialog" bis_skin_checked="1">
              <div class="modal-content" bis_skin_checked="1">
                <div class="modal-header" bis_skin_checked="1">
                  <h5 class="modal-title mt-0" id="myModalLabel">Добавить Категорию</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                  </button>
                </div>
                <div class="modal-body" bis_skin_checked="1">
                  <div class="row" bis_skin_checked="1">
                    <form action="/category/add" method="post" enctype="multipart/form-data">
                      <div class="col-lg-12" bis_skin_checked="1">
                        <div class="mb-3" bis_skin_checked="1">
                          <label class="form-label" for="manufacturername">Название категория</label>
                          <input id="manufacturername" name="title" type="text" class="form-control">
                        </div>
                      </div>

                      <div class="col-lg-12" bis_skin_checked="1">
                        <div class="mb-3" bis_skin_checked="1">
                          <label class="form-label" for="manufacturerbrand">Ссылка</label>
                          <input id="manufacturerbrand" name="slug" type="text" class="form-control">
                        </div>
                      </div>

                      <div class="mb-4 col-lg-12" bis_skin_checked="1">
                        <input type="file" class="form-control-file" name="img">
                      </div>

                        <div class="form-check form-switch mb-3" dir="ltr" bis_skin_checked="1">
                          <input type="checkbox" class="form-check-input" id="customSwitch1" checked="" name="status" value="1">
                          <label class="form-check-label" for="customSwitch1">Активность</label>
                        </div>

                      <div class="modal-footer" bis_skin_checked="1">
                        <button type="button" class="btn btn-light waves-effect" data-bs-dismiss="modal">Закрыть</button>
                        <button type="submit" class="btn btn-primary waves-effect waves-light">Добавить</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
          </div>

          <!-- edit Category -->
          <div id="editModal" class="modal fade" tabindex="-1" aria-labelledby="myModalLabel" bis_skin_checked="1"
            style="display: none;" aria-hidden="true">
            <div class="modal-dialog" bis_skin_checked="1">
              <div class="modal-content" bis_skin_checked="1">
                <div class="modal-header" bis_skin_checked="1">
                  <h5 class="modal-title mt-0" id="myModalLabel">Изменение категория</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                  </button>
                </div>
                <div class="modal-body" bis_skin_checked="1">
                  <div class="row" bis_skin_checked="1">
                    <form action="/category/save" method="post" enctype="multipart/form-data" name="editForm">
                      <input type="hidden" name="_id">
                      <div class="col-lg-12" bis_skin_checked="1">
                        <div class="mb-3" bis_skin_checked="1">
                          <label class="form-label" for="manufacturername">Название категория</label>
                          <input id="manufacturername" name="title" type="text" class="form-control">
                        </div>
                      </div>

                      <div class="col-lg-12" bis_skin_checked="1">
                        <div class="mb-3" bis_skin_checked="1">
                          <label class="form-label" for="manufacturerbrand">Ссылка</label>
                          <input id="manufacturerbrand" name="slug" type="text" class="form-control">
                        </div>
                      </div>

                      <div class="mb-4 col-lg-12" bis_skin_checked="1">
                        <input type="file" class="form-control-file" name="img">
                      </div>

                      <div class="form-check form-switch mb-3" dir="ltr" bis_skin_checked="1">
                        <input type="checkbox" class="form-check-input" id="customSwitch1" checked="" name="status" value="1">
                        <label class="form-check-label" for="customSwitch1">Активность</label>
                      </div>

                      <div class="modal-footer" bis_skin_checked="1">
                        <button type="button" class="btn btn-light waves-effect" data-bs-dismiss="modal">Закрыть</button>
                        <button type="submit" class="btn btn-primary waves-effect waves-light">Изменить</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
          </div>

        </div>
      </div>
    </div>
  </div> <!-- end col -->
</div>

<script>
  
  let editForm = document.forms.editForm

  function change(id){
    fetch(`/category/change/${id}`)
    .then(res => res.json())
    .then(category =>{
      editForm._id.value = id
      editForm.title.value = category.title
      editForm.slug.value = category.slug
      editForm.status.checked = category.status == 1 ? true : false
    })
  }

  if(document.getElementById('error')){
    setTimeout(() =>{
      document.getElementById('error').remove()
    }, 5000)
  }
  if(document.getElementById('success')){
    setTimeout(() =>{
      document.getElementById('success').remove()
    }, 5000)
  }

</script>